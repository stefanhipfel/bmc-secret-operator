{{- if .Values.crd.enable }}
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
    annotations:
        controller-gen.kubebuilder.io/version: v0.20.0
    name: secretbackendconfigs.config.metal.ironcore.dev
spec:
    group: config.metal.ironcore.dev
    names:
        kind: SecretBackendConfig
        listKind: SecretBackendConfigList
        plural: secretbackendconfigs
        singular: secretbackendconfig
    scope: Cluster
    versions:
        - name: v1alpha1
          schema:
            openAPIV3Schema:
                description: SecretBackendConfig is the Schema for the secretbackendconfigs API
                properties:
                    apiVersion:
                        description: |-
                            APIVersion defines the versioned schema of this representation of an object.
                            Servers should convert recognized schemas to the latest internal value, and
                            may reject unrecognized values.
                            More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
                        type: string
                    kind:
                        description: |-
                            Kind is a string value representing the REST resource this object represents.
                            Servers may infer this from the endpoint the client submits requests to.
                            Cannot be updated.
                            In CamelCase.
                            More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                        type: string
                    metadata:
                        type: object
                    spec:
                        description: spec defines the desired state of SecretBackendConfig
                        properties:
                            backend:
                                description: Backend specifies the type of secret backend to use (vault, openbao)
                                enum:
                                    - vault
                                    - openbao
                                type: string
                            openBaoConfig:
                                description: OpenBaoConfig contains OpenBao-specific configuration
                                properties:
                                    address:
                                        description: Address is the OpenBao server URL
                                        type: string
                                    authMethod:
                                        description: Configuration fields will mirror VaultConfig
                                        type: string
                                required:
                                    - address
                                type: object
                            pathTemplate:
                                default: bmc/{{ "{{.Region}}" }}/{{ "{{.Hostname}}" }}/{{ "{{.Username}}" }}
                                description: |-
                                    PathTemplate is the template string for building secret paths
                                    Available variables: {{ "{{.Region}}" }}, {{ "{{.Hostname}}" }}, {{ "{{.Username}}" }}
                                type: string
                            regionLabelKey:
                                default: region
                                description: RegionLabelKey is the label key to extract region from BMC resources
                                type: string
                            syncLabel:
                                description: |-
                                    SyncLabel is the label key that must be present on BMCSecrets to enable syncing
                                    If not specified, all BMCSecrets will be synced
                                type: string
                            vaultConfig:
                                description: VaultConfig contains Vault-specific configuration
                                properties:
                                    address:
                                        description: Address is the Vault server URL
                                        type: string
                                    authMethod:
                                        default: kubernetes
                                        description: AuthMethod specifies the authentication method (kubernetes, token, approle)
                                        enum:
                                            - kubernetes
                                            - token
                                            - approle
                                        type: string
                                    kubernetesAuth:
                                        description: KubernetesAuth contains Kubernetes auth configuration
                                        properties:
                                            path:
                                                default: kubernetes
                                                description: Path is the Kubernetes auth mount path
                                                type: string
                                            role:
                                                description: Role is the Vault role to authenticate as
                                                type: string
                                        required:
                                            - role
                                        type: object
                                    mountPath:
                                        default: secret
                                        description: MountPath is the KV secrets engine mount path
                                        type: string
                                    tlsConfig:
                                        description: TLSConfig contains TLS configuration
                                        properties:
                                            caCert:
                                                description: CACert is the CA certificate for verifying the Vault server
                                                type: string
                                            skipVerify:
                                                default: false
                                                description: SkipVerify disables TLS certificate verification (not recommended for production)
                                                type: boolean
                                        type: object
                                    tokenAuth:
                                        description: TokenAuth contains token auth configuration
                                        properties:
                                            secretRef:
                                                description: SecretRef references a Kubernetes secret containing the Vault token
                                                properties:
                                                    key:
                                                        description: Key is the key in the secret data
                                                        type: string
                                                    name:
                                                        description: Name is the name of the secret
                                                        type: string
                                                    namespace:
                                                        description: Namespace is the namespace of the secret
                                                        type: string
                                                required:
                                                    - key
                                                    - name
                                                    - namespace
                                                type: object
                                        required:
                                            - secretRef
                                        type: object
                                required:
                                    - address
                                type: object
                        required:
                            - backend
                        type: object
                    status:
                        description: status defines the observed state of SecretBackendConfig
                        properties:
                            conditions:
                                description: |-
                                    conditions represent the current state of the SecretBackendConfig resource.
                                    Each condition has a unique type and reflects the status of a specific aspect of the resource.

                                    Standard condition types include:
                                    - "Available": the resource is fully functional
                                    - "Progressing": the resource is being created or updated
                                    - "Degraded": the resource failed to reach or maintain its desired state

                                    The status of each condition is one of True, False, or Unknown.
                                items:
                                    description: Condition contains details for one aspect of the current state of this API Resource.
                                    properties:
                                        lastTransitionTime:
                                            description: |-
                                                lastTransitionTime is the last time the condition transitioned from one status to another.
                                                This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                                            format: date-time
                                            type: string
                                        message:
                                            description: |-
                                                message is a human readable message indicating details about the transition.
                                                This may be an empty string.
                                            maxLength: 32768
                                            type: string
                                        observedGeneration:
                                            description: |-
                                                observedGeneration represents the .metadata.generation that the condition was set based upon.
                                                For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                                                with respect to the current state of the instance.
                                            format: int64
                                            minimum: 0
                                            type: integer
                                        reason:
                                            description: |-
                                                reason contains a programmatic identifier indicating the reason for the condition's last transition.
                                                Producers of specific condition types may define expected values and meanings for this field,
                                                and whether the values are considered a guaranteed API.
                                                The value should be a CamelCase string.
                                                This field may not be empty.
                                            maxLength: 1024
                                            minLength: 1
                                            pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                                            type: string
                                        status:
                                            description: status of the condition, one of True, False, Unknown.
                                            enum:
                                                - "True"
                                                - "False"
                                                - Unknown
                                            type: string
                                        type:
                                            description: type of condition in CamelCase or in foo.example.com/CamelCase.
                                            maxLength: 316
                                            pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                                            type: string
                                    required:
                                        - lastTransitionTime
                                        - message
                                        - reason
                                        - status
                                        - type
                                    type: object
                                type: array
                                x-kubernetes-list-map-keys:
                                    - type
                                x-kubernetes-list-type: map
                        type: object
                required:
                    - spec
                type: object
          served: true
          storage: true
          subresources:
            status: {}
{{- end }}
